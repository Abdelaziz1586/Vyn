use "java:me.abdelaziz.bda.BDALib"

lock TOKEN "MTQ0ODIyMzU4MjA4ODk4NjY4Ng.GlGsde.WLmujCDsbFZDYeJB2b21hrt2Maw2HBgiiZwpQE"

~ Define the Event Listener
blueprint Listener mimics BDAListener do
    task onReady takes event do
        make selfUser event.getJDA().getSelfUser()
        say "Bot has started! Logged in as: " + selfUser.getName()
    end

    task onMessageReceived takes event do
        make author event.getAuthor()

        check !author.isBot() do
             event.getChannel().sendMessage("Hello " + author.getName() + "!").queue()
        end
    end
end

say "Initializing BDA..."

~ Create Bot instance
make bot new BDA(TOKEN)

~ Register Listener
bot.addListener(new Listener())

~ Connect to Discord
bot.connect()

say "Bot is running..."
say "Type 'stop' in the console to shutdown."

~ ---------------------------------------------------------
~ CONSOLE INPUT LOOP
~ ---------------------------------------------------------
cycle while true do
    ~ input() pauses the script until the user types a line
    make command input()

    check command == "stop" do
        say "Shutdown command received."

        ~ Disconnect the bot
        bot.disconnect()

        say "Goodbye!"

        ~ Break out of the loop to end the program
        escape
    end

    ~ You can add other console commands here
    check command == "status" do
        say "Current Status: " + bot.getStatus()
    end
end